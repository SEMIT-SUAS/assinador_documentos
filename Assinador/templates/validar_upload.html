<!DOCTYPE html>
<html lang="pt-br" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Verificação por Upload</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<style>
  /* Fundo suave */
  body { background: linear-gradient(180deg, #f6faff 0%, #ffffff 120%); }

  /* Card base */
  .crc-card {
    border: 1px solid #eef2f6;
    border-radius: 14px;
    box-shadow: 0 10px 30px -20px rgba(20,30,50,.25);
  }

  /* Área de drop */
  .drop-area {
    border: 2px dashed #dbe4f0;
    border-radius: 12px;
    min-height: 220px;
    display: grid;
    place-items: center;
    text-align: center;
    padding: 1.25rem;
    transition: border-color .15s ease, background-color .15s ease, box-shadow .15s ease;
    cursor: pointer;
  }
  .drop-area.dragover {
    border-color: #84aef9;
    background: #f3f8ff;
    box-shadow: 0 6px 24px -18px rgba(13,110,253,.6);
  }

  /* Ícone circular */
  .upload-icon {
    width: 56px; height: 56px;
    border-radius: 999px;
    background: #eef4ff;
    color: #4378ff;
    display: grid; place-items: center;
    margin: 0 auto .75rem;
  }

  /* Alerta suave */
  .soft-alert { background: #fff7e6; border-color: #ffe1a7; border-radius: 12px; }
  .soft-alert .icon-badge {
    width: 34px; height: 34px; border-radius: 999px; background: #fff1c4; color: #a15b00;
    display: grid; place-items: center;
  }

  .btn-upload { padding-inline: 1.25rem; }
  .page-header img { height: 56px; width: auto; }
</style>

<body class="container py-4">
  <!-- Cabeçalho -->
  <div class="page-header d-flex flex-wrap justify-content-between align-items-center gap-3 mb-4">
    <a href="{{ url_for('verificar') }}" class="btn btn-outline-secondary btn-sm">
      &#8592; <span class="d-none d-sm-inline">Voltar</span>
    </a>
    <h1 class="h3 mb-0 fw-semibold">Verificação por Upload</h1>
    <img src="{{ url_for('static', filename='img/logo_selo.png') }}" alt="Selo de Autenticação Eletrônica">
  </div>

  {% if erro %}
    <div class="alert alert-danger shadow-sm">{{ erro }}</div>
  {% endif %}

  <!-- CARD UPLOAD -->
  <div class="card crc-card mb-4">
    <div class="card-body p-4 p-md-5">
      <h2 class="h5 fw-bold mb-1">Escolha o arquivo para validar</h2>
      <p class="text-muted mb-4">Arraste e solte seu documento ou clique para selecionar</p>

      <!-- Form mantém endpoint e enctype -->
      <form id="uploadForm" method="POST" enctype="multipart/form-data" action="{{ url_for('validar_upload') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <!-- Área de drop/click: agora é DIV (não LABEL) -->
        <div class="drop-area mb-4" id="dropArea" tabindex="0" role="button" aria-label="Selecionar arquivo para validar">
          <div>
            <div class="upload-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5A1.5 1.5 0 0 0 2.5 14h11a1.5 1.5 0 0 0 1.5-1.5v-2.5a.5.5 0 0 1 1 0v2.5A2.5 2.5 0 0 1 13.5 15h-11A2.5 2.5 0 0 1 0 12.9v-2.5a.5.5 0 0 1 .5-.5"/>
                <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L4.354 4.854a.5.5 0 1 1-.708-.708z"/>
              </svg>
            </div>
            <div class="mb-1 fw-semibold">Selecione um arquivo</div>
            <div class="text-muted small">PDF</div>
          </div>
        </div>

        <!-- Input real (visível só para leitores de tela) -->
        <input id="arquivo" name="arquivo" type="file" class="visually-hidden" required>

        <!-- Botão enviar -->
        <div class="text-center">
          <button class="btn btn-primary btn-upload" type="submit">Validar arquivo</button>
        </div>
      </form>
    </div>
  </div>

  <!-- AVISO -->
  <div class="alert alert-warning soft-alert d-flex align-items-start gap-3 shadow-sm" role="alert">
    <div class="icon-badge">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" aria-hidden="true">
        <path d="M7.938 2.016a.13.13 0 0 1 .124 0 .15.15 0 0 1 .054.057l6.857 11.667a.2.2 0 0 1-.118.297H1.146a.2.2 0 0 1-.118-.297L7.885 2.073a.15.15 0 0 1 .053-.057z"/>
        <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
      </svg>
    </div>
    <div>
      <div class="fw-semibold mb-1">Importante sobre a verificação</div>
      <p class="mb-2">O sistema irá conferir a sua cópia com o documento original registrado, garantindo que o arquivo que você tem em mãos é autêntico e não foi alterado.</p>
      <p class="mb-0"><strong>Importante:</strong> a validação considera sempre a <u>última versão oficial assinada</u> do arquivo.</p>
    </div>
  </div>

  <!-- RESULTADO (opcional) -->
  {% if match is not none %}
    {% if match %}
      <div class="alert alert-success mt-4 text-center shadow-sm">✔ Este arquivo é idêntico a um documento oficial.</div>
      {% if caminho %}
        <div class="text-center">
          <a class="btn btn-outline-success" href="{{ caminho }}" target="_blank" rel="noopener">Abrir cópia oficial</a>
        </div>
      {% endif %}
    {% else %}
      <div class="alert alert-danger mt-4 text-center shadow-sm">✖ O arquivo não corresponde a nenhum documento oficial cadastrado.</div>
    {% endif %}
  {% endif %}

  <script>
    // JS leve para arrastar/soltar e selecionar sem duplicar o diálogo
    (function(){
      const drop = document.getElementById('dropArea');
      const input = document.getElementById('arquivo');

      // Clique ou Enter/Espaço na área abre o seletor
      drop.addEventListener('click', () => input.click());
      drop.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); input.click(); }
      });

      // Drag & drop
      ['dragenter','dragover'].forEach(evt =>
        drop.addEventListener(evt, (e) => { e.preventDefault(); e.stopPropagation(); drop.classList.add('dragover'); })
      );
      ['dragleave','drop'].forEach(evt =>
        drop.addEventListener(evt, (e) => { e.preventDefault(); e.stopPropagation(); drop.classList.remove('dragover'); })
      );

      drop.addEventListener('drop', (e) => {
        const files = e.dataTransfer?.files;
        if (!files || !files.length) return;
        input.files = files; // preenche o input (um clique só)
      });
    })();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
